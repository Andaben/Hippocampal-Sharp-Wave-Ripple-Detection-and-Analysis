#include "BandPassFilter.h"

static int filter_taps[BANDPASSFILTER_TAP_NUM] = {
18495,-61912,-156525,-258731,-359979,-450441,-519915,-558879,-559595,-517133,-430193,-301623,-138514,48147,244288,433965,600880,730059,809512,831675,794473,701834,563561,394525,213219,39792,-106254,-208461,-255625,-243561,-176165,-65595,68538,200955,303341,347633,309602,172374,-70527,-413019,-835487,-1305251,-1778546,-2203944,-2526993,-2695671,-2666164,-2408366,-1910507,-1182338,-256432,812715,1951845,3074221,4086680,4897839,5426735,5611050,5414076,4829637,3884356,2636889,1174024,-396131,-1953341,-3376011,-4552530,-5392065,-5833685,-5852818,-5464255,-4721247,-3710622,-2544257,-1347647,-246647,646288,1244917,1499655,1404415,998910,365938,-376346,-1086609,-1615900,-1825126,-1602651,-880117,355329,2053979,4102781,6331370,8524749,10441776,11837940,12490374,12222700,10927162,8581606,5259269,1129918,-3548347,-8446382,-13189250,-17387446,-20671372,-22725933,-23321881,-22340740,-19790578,-15810684,-10664192,-4718829,1582835,7761223,13342282,17900793,21100255,22725308,22703271,21112266,18174677,14236077,9731234,5140183,938446,-2453724,-4717896,-5674815,-5308305,-3772585,-1381428,1420627,4102994,6105902,6904215,6071991,3341144,-1352218,-7839396,-15712749,-24343652,-32924684,-40533665,-46214830,-49070510,-48355249,-43563548,-34502466,-21341215,-4631494,14705314,35425213,56040947,74928682,90454304,101109457,105646063,103197628,93376196,76335390,52792453,24005412,-8294870,-42014180,-74838727,-104402860,-128467955,-145098380,-152820235,-150749521,-138678580,-117112724,-87252870,-50924273,-10455835,31481465,72065042,108525589,138350556,159470362,170412690,170412690,159470362,138350556,108525589,72065042,31481465,-10455835,-50924273,-87252870,-117112724,-138678580,-150749521,-152820235,-145098380,-128467955,-104402860,-74838727,-42014180,-8294870,24005412,52792453,76335390,93376196,103197628,105646063,101109457,90454304,74928682,56040947,35425213,14705314,-4631494,-21341215,-34502466,-43563548,-48355249,-49070510,-46214830,-40533665,-32924684,-24343652,-15712749,-7839396,-1352218,3341144,6071991,6904215,6105902,4102994,1420627,-1381428,-3772585,-5308305,-5674815,-4717896,-2453724,938446,5140183,9731234,14236077,18174677,21112266,22703271,22725308,21100255,17900793,13342282,7761223,1582835,-4718829,-10664192,-15810684,-19790578,-22340740,-23321881,-22725933,-20671372,-17387446,-13189250,-8446382,-3548347,1129918,5259269,8581606,10927162,12222700,12490374,11837940,10441776,8524749,6331370,4102781,2053979,355329,-880117,-1602651,-1825126,-1615900,-1086609,-376346,365938,998910,1404415,1499655,1244917,646288,-246647,-1347647,-2544257,-3710622,-4721247,-5464255,-5852818,-5833685,-5392065,-4552530,-3376011,-1953341,-396131,1174024,2636889,3884356,4829637,5414076,5611050,5426735,4897839,4086680,3074221,1951845,812715,-256432,-1182338,-1910507,-2408366,-2666164,-2695671,-2526993,-2203944,-1778546,-1305251,-835487,-413019,-70527,172374,309602,347633,303341,200955,68538,-65595,-176165,-243561,-255625,-208461,-106254,39792,213219,394525,563561,701834,794473,831675,809512,730059,600880,433965,244288,48147,-138514,-301623,-430193,-517133,-559595,-558879,-519915,-450441,-359979,-258731,-156525,-61912,18495
};

void BandPassFilter_init(BandPassFilter* f) {
  int i;
  for(i = 0; i < BANDPASSFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void BandPassFilter_put(BandPassFilter* f, int input) {
  f->history[f->last_index++] = input;
  if(f->last_index == BANDPASSFILTER_TAP_NUM)
    f->last_index = 0;
}

int BandPassFilter_get(BandPassFilter* f) {
  long long acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < BANDPASSFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : BANDPASSFILTER_TAP_NUM-1;
    acc += (long long)f->history[index] * filter_taps[i];
  };
  return acc >> 32;
  
}
